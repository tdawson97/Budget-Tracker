@using Microsoft.AspNetCore.Http.Features
@model List<BudgetTrackerWeb.Models.Expense>
<h2>Expenses</h2>
<div class="d-flex justify-content-between">
  <a href="/Expenses/Create">Add Expense</a>
  <form asp-action="Index" method="get">
    <select name="categoryFilter" class="form-control">
      <option value="">All Categories</option>
      @foreach (var category in ViewBag.CategoryList)
      {
        <option value="@category.Text">
          @category.Text
        </option>
      }
    </select>
    <input type="text" name="searchString" class="form-control" placeholder="Search by description" value="@Context.Request.Query["searchString"]" />
    <button type="submit">Filter</button>
  </form>
</div>

<div>
  <table class="table table-striped table-bordered text-center">
    <thead class="table-dark">
      <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody>
      @foreach (var expense in Model)
      {
        <tr>
          <td>@expense.Date.ToShortDateString()</td>
          <td>@expense.Category</td>
          <td>@expense.Description</td>
          <td>@expense.Amount.ToString("C")</td>
          <td>
            <form asp-action="Edit" asp-route-id="@expense.Id" method="get" style="display:inline">
              <button type="submit" class="btn btn-sm btn-warning">
            Edit
              </button>
            </form>
          </td>
          <td>
            <form asp-action="Delete" asp-route-id="@expense.Id" method="post" style="display:inline">
              <button type="submit" class="btn btn-sm btn-danger"
                onclick="return confirm('Are you sure you want to delete this expense?');">
            Delete
              </button>
            </form>
          </td>
        </tr>
       }
       <tr>
        <td>Total Amount</td>
        <td></td>
        <td></td>
        <td>@ViewBag.TotalAmount.ToString("C")</td>
       </tr>
    </tbody>
  </table>
</div>
